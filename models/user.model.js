const { Schema, model } = require('mongoose');

/**
 * User document shape
 * ───────────────────────────────
 * user_id     ObjectId  – autogenerated
 * role_id     ObjectId  – role id
 * * username    String    – username
 * * password    String    – password
 * * email       String    – email
 * * neighbourhood String    – neighbourhood
 * location: {             - GeoJSON point
 *  type         String    - JSON type of 'Point"
 *  coordinates [Number]   - [long, lat]
 * }
 */
const UserSchema = new Schema(
{
    role_id: {
      type: String,
      ref : 'Role',
      required: true,
    },
    username: {
      type: String,
      required: true,
      trim: true,
    }, 
    password: {
      type: String,
      required: true,
      trim: true,
    },
    email: {
      type: String,
      required: true,
      trim: true,
    },
    neighbourhood: {
      type: String,
      required: true,
      trim: true,
    },

    location: {
      type: {
        type: String,
        enum: ['Point']
      },
      coordinates: {
        type: [Number],
        default: [0,0],
        required: true
      }
    }
},
  {
    timestamps: { createdAt: 'created_at', updatedAt: 'updated_at' },
    collection: 'Users',
  }
);

//Defining a geospatial index for queries and maps
UserSchema.index({ location: '2dsphere' });

module.exports = model('User', UserSchema);
